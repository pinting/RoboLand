"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Processor_1 = require("./Interpreter/Processor");
const Runner_1 = require("./Interpreter/Runner");
const Map_1 = require("./Map");
const Coord_1 = require("./Coord");
const Utils_1 = require("./Utils");
Utils_1.Utils.Extract(window, { Coord: Coord_1.Coord, Map: Map_1.Map, Utils: Utils_1.Utils, Processor: Processor_1.Processor, Runner: Runner_1.Runner });
const canvas = document.getElementById("canvas");
const context = canvas.getContext("2d");
const codeTextarea = document.getElementById("code");
const pushButton = document.getElementById("push");
const stopButton = document.getElementById("stop");
let map = Map_1.Map.GetInstance();
let runner = null;
const last = [];
let player = null;
let enemy = null;
const size = 30;
const draw = (e, loaded) => {
    let coord = e.GetPosition();
    let x = coord.X;
    let y = coord.Y;
    let image = new Image();
    image.onload = () => {
        context.drawImage(image, x * size, y * size, size, size);
        loaded();
    };
    image.src = e.GetTexture();
};
const update = () => {
    if (!runner) {
        player = map.GetRobots()[0];
        enemy = map.GetRobots()[1];
        runner = new Runner_1.Runner(player);
        canvas.width = size * map.GetSize();
        canvas.height = size * map.GetSize();
        canvas.onclick = e => update();
        let i = 0;
        map.GetCells().forEach(cell => {
            draw(cell, () => {
                if (++i == map.GetSize()) {
                    map.GetRobots().forEach(robot => {
                        last.push(robot.GetPosition().Clone());
                        draw(robot, Utils_1.Utils.Noop);
                    });
                }
            });
        });
    }
    else {
        let i = 0;
        last.forEach(c => {
            draw(map.GetCell(c), Utils_1.Utils.Noop);
            if (++i == last.length) {
                last.length = 0;
                map.GetRobots().forEach(robot => {
                    last.push(robot.GetPosition().Clone());
                    draw(robot, Utils_1.Utils.Noop);
                });
            }
        });
    }
    if (!player.IsAlive() || !enemy.IsAlive()) {
        alert(player.IsAlive() ? "You won!" : "You lose!");
        stopButton.disabled = true;
        pushButton.disabled = true;
        runner.Stop();
    }
};
pushButton.onclick = e => runner.Run(codeTextarea.value);
stopButton.onclick = e => runner.Stop();
Utils_1.Utils.Get("res/example.txt").then(result => codeTextarea.value = result);
map.Load("res/map.json");
map.OnUpdate = update;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUMsUUFBUSxHQUFHLElBQUksQ0FBQztRQUMzQixVQUFVLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztRQUUzQixNQUFNLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDbEIsQ0FBQztBQUNMLENBQUMsQ0FBQztBQUVGLFVBQVUsQ0FBQyxPQUFPLEdBQUcsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ3pELFVBQVUsQ0FBQyxPQUFPLEdBQUcsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUV4QyxhQUFLLENBQUMsR0FBRyxDQUFDLGlCQUFpQixDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sSUFBSSxZQUFZLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQyxDQUFDO0FBQ3pFLEdBQUcsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7QUFFekIsR0FBRyxDQUFDLFFBQVEsR0FBRyxNQUFNLENBQUMiLCJmaWxlIjoid3d3L2xpYi9pbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElSb2JvdCB9IGZyb20gJy4vRWxlbWVudC9Sb2JvdC9JUm9ib3QnO1xyXG5pbXBvcnQgeyBQcm9jZXNzb3IgfSBmcm9tICcuL0ludGVycHJldGVyL1Byb2Nlc3Nvcic7XHJcbmltcG9ydCB7IFJ1bm5lciB9IGZyb20gJy4vSW50ZXJwcmV0ZXIvUnVubmVyJztcclxuaW1wb3J0IHsgTWFwIH0gZnJvbSBcIi4vTWFwXCI7XHJcbmltcG9ydCB7IENvb3JkIH0gZnJvbSBcIi4vQ29vcmRcIjtcclxuaW1wb3J0IHsgSUVsZW1lbnQgfSBmcm9tIFwiLi9FbGVtZW50L0lFbGVtZW50XCI7XHJcbmltcG9ydCB7IFV0aWxzIH0gZnJvbSBcIi4vVXRpbHNcIjtcclxuXHJcblV0aWxzLkV4dHJhY3Qod2luZG93LCB7IENvb3JkLCBNYXAsIFV0aWxzLCBQcm9jZXNzb3IsIFJ1bm5lciB9KTtcclxuXHJcbmNvbnN0IGNhbnZhcyA9IDxIVE1MQ2FudmFzRWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNhbnZhc1wiKTtcclxuY29uc3QgY29udGV4dCA9IDxDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ+Y2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcclxuXHJcbmNvbnN0IGNvZGVUZXh0YXJlYSA9IDxIVE1MVGV4dEFyZWFFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY29kZVwiKTtcclxuY29uc3QgcHVzaEJ1dHRvbiA9IDxIVE1MQnV0dG9uRWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInB1c2hcIik7XHJcbmNvbnN0IHN0b3BCdXR0b24gPSA8SFRNTEJ1dHRvbkVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzdG9wXCIpO1xyXG5cclxubGV0IG1hcDogTWFwID0gTWFwLkdldEluc3RhbmNlKCk7XHJcbmxldCBydW5uZXI6IFJ1bm5lciA9IG51bGw7XHJcblxyXG5jb25zdCBsYXN0OiBBcnJheTxDb29yZD4gPSBbXTtcclxuXHJcbmxldCBwbGF5ZXI6IElSb2JvdCA9IG51bGw7XHJcbmxldCBlbmVteTogSVJvYm90ID0gbnVsbDtcclxuXHJcbmNvbnN0IHNpemU6IG51bWJlciA9IDMwO1xyXG5cclxuLyoqXHJcbiAqIERyYXcgdGhlIGdpdmVuIGVsZW1lbnQgb250byB0aGUgY2FudmFzLlxyXG4gKiBAcGFyYW0gZVxyXG4gKiBAcGFyYW0gY2FsbGJhY2tcclxuICovXHJcbmNvbnN0IGRyYXcgPSAoZTogSUVsZW1lbnQsIGxvYWRlZDogKCkgPT4gdm9pZCkgPT5cclxue1xyXG4gICAgbGV0IGNvb3JkID0gZS5HZXRQb3NpdGlvbigpO1xyXG4gICAgbGV0IHggPSBjb29yZC5YO1xyXG4gICAgbGV0IHkgPSBjb29yZC5ZO1xyXG5cclxuICAgIGxldCBpbWFnZSA9IG5ldyBJbWFnZSgpO1xyXG4gICAgXHJcbiAgICBpbWFnZS5vbmxvYWQgPSAoKSA9PiBcclxuICAgIHtcclxuICAgICAgICBjb250ZXh0LmRyYXdJbWFnZShpbWFnZSwgeCAqIHNpemUsIHkgKiBzaXplLCBzaXplLCBzaXplKTtcclxuICAgICAgICBsb2FkZWQoKTtcclxuICAgIH07XHJcblxyXG4gICAgaW1hZ2Uuc3JjID0gZS5HZXRUZXh0dXJlKCk7XHJcbn07XHJcblxyXG4vKipcclxuICogVXBkYXRlIHRoZSBjYW52YXMuXHJcbiAqL1xyXG5jb25zdCB1cGRhdGUgPSAoKSA9PiBcclxue1xyXG4gICAgaWYoIXJ1bm5lcikgXHJcbiAgICB7XHJcbiAgICAgICAgcGxheWVyID0gbWFwLkdldFJvYm90cygpWzBdO1xyXG4gICAgICAgIGVuZW15ID0gbWFwLkdldFJvYm90cygpWzFdO1xyXG5cclxuICAgICAgICBydW5uZXIgPSBuZXcgUnVubmVyKHBsYXllcik7XHJcblxyXG4gICAgICAgIGNhbnZhcy53aWR0aCA9IHNpemUgKiBtYXAuR2V0U2l6ZSgpO1xyXG4gICAgICAgIGNhbnZhcy5oZWlnaHQgPSBzaXplICogbWFwLkdldFNpemUoKTtcclxuICAgICAgICBjYW52YXMub25jbGljayA9IGUgPT4gdXBkYXRlKCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgbGV0IGkgPSAwO1xyXG5cclxuICAgICAgICAvLyBEcmF3IGNlbGxzIGZpcnN0XHJcbiAgICAgICAgbWFwLkdldENlbGxzKCkuZm9yRWFjaChjZWxsID0+IFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZHJhdyhjZWxsLCAoKSA9PiBcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy8gV2hlbiB0aGUgbGFzdCB3YXMgZHJhd24sIHN0YXJ0IGRyYXdpbmcgdGhlIHJvYm90c1xyXG4gICAgICAgICAgICAgICAgaWYoKytpID09IG1hcC5HZXRTaXplKCkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFwLkdldFJvYm90cygpLmZvckVhY2gocm9ib3QgPT4gXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYXN0LnB1c2gocm9ib3QuR2V0UG9zaXRpb24oKS5DbG9uZSgpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZHJhdyhyb2JvdCwgVXRpbHMuTm9vcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGVsc2VcclxuICAgIHtcclxuICAgICAgICBsZXQgaSA9IDA7XHJcblxyXG4gICAgICAgIC8vIE9ubHkgZHJhdyBjZWxscyB3aGVyZSB0aGUgcm9ib3RzIHdlcmVcclxuICAgICAgICBsYXN0LmZvckVhY2goYyA9PiBcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGRyYXcobWFwLkdldENlbGwoYyksIFV0aWxzLk5vb3ApO1xyXG5cclxuICAgICAgICAgICAgaWYoKytpID09IGxhc3QubGVuZ3RoKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvLyBDbGVhciB0aGUgYXJyYXlcclxuICAgICAgICAgICAgICAgIGxhc3QubGVuZ3RoID0gMDtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBSZWRyYXcgcm9ib3RzXHJcbiAgICAgICAgICAgICAgICBtYXAuR2V0Um9ib3RzKCkuZm9yRWFjaChyb2JvdCA9PiBcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBsYXN0LnB1c2gocm9ib3QuR2V0UG9zaXRpb24oKS5DbG9uZSgpKTtcclxuICAgICAgICAgICAgICAgICAgICBkcmF3KHJvYm90LCBVdGlscy5Ob29wKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYoIXBsYXllci5Jc0FsaXZlKCkgfHwgIWVuZW15LklzQWxpdmUoKSlcclxuICAgIHtcclxuICAgICAgICBhbGVydChwbGF5ZXIuSXNBbGl2ZSgpID8gXCJZb3Ugd29uIVwiIDogXCJZb3UgbG9zZSFcIik7XHJcblxyXG4gICAgICAgIHN0b3BCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgIHB1c2hCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xyXG5cclxuICAgICAgICBydW5uZXIuU3RvcCgpO1xyXG4gICAgfVxyXG59O1xyXG5cclxucHVzaEJ1dHRvbi5vbmNsaWNrID0gZSA9PiBydW5uZXIuUnVuKGNvZGVUZXh0YXJlYS52YWx1ZSk7XHJcbnN0b3BCdXR0b24ub25jbGljayA9IGUgPT4gcnVubmVyLlN0b3AoKTtcclxuXHJcblV0aWxzLkdldChcInJlcy9leGFtcGxlLnR4dFwiKS50aGVuKHJlc3VsdCA9PiBjb2RlVGV4dGFyZWEudmFsdWUgPSByZXN1bHQpO1xyXG5tYXAuTG9hZChcInJlcy9tYXAuanNvblwiKTtcclxuXHJcbm1hcC5PblVwZGF0ZSA9IHVwZGF0ZTsiXX0=
